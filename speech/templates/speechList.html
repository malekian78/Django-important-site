{% extends 'base.html' %}
{% load static %}

{% block stylesImports %}
  {% comment %} <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mediaelement/4.2.7/mediaelementplayer.min.css" rel="stylesheet" />
  <link href="{% static './speech-styles.css' %}" rel="stylesheet" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sofia" /> {% endcomment %}

  <link href="{% static './speech-list-style.css' %}" rel="stylesheet" />
{% endblock %}

{% block javaScripImports %}
  <script>
    /* 
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.category-parent').forEach(parentCheckbox => {
        parentCheckbox.addEventListener('change', function () {
          const parentId = this.value;
          const children = document.querySelectorAll(
            `.category-child[data-parent="${parentId}"]`
          );

          children.forEach(child => {
            child.checked = this.checked;
          });
        });
      });
    });*/
    document.addEventListener('DOMContentLoaded', function () {

      function toggleChildren(parentCheckbox, checked) {
        const parentId = parentCheckbox.dataset.id;
        const children = document.querySelectorAll(
          `.category-checkbox[data-parent="${parentId}"]`
        );

        children.forEach(child => {
          child.checked = checked;
          toggleChildren(child, checked);
        });
      }

      document.querySelectorAll('.category-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function () {
          toggleChildren(this, this.checked);
        });
      });

    });
  </script>
{% endblock %}

{% block content %}
  <div class="speeches-container">
    {% comment %}Filters{% endcomment %}
    <div class="filters-for-speech-list">
      <form method="get">
        <div class="search-input-box">
          <input type="text" name="search" placeholder="جستجو..." value="{{ request.GET.search }}" />
          <button type="submit">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 256 256">
              <g fill="currentColor" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none">
                <g transform="scale(10.66667,10.66667)">
                  <path d="M10,2c-4.40347,0 -8,3.59653 -8,8c0,4.40347 
            3.59653,8 8,8c1.75213,0 3.37052,-0.57793 
            4.69141,-1.54102l5.1543,5.1543c0.31352,0.32654 
            0.77908,0.45808 1.21713,0.34388c0.43805,-0.1142 
            0.78014,-0.45628 0.89433,-0.89433c0.1142,-0.43805 
            -0.01734,-0.90361 -0.34388,-1.21713l-5.1543,-5.1543
            c0.96309,-1.32088 1.54102,-2.93928 1.54102,-4.69141
            c0,-4.40347 -3.59653,-8 -8,-8zM10,4.5c3.05237,0 
            5.5,2.44763 5.5,5.5c0,3.05237 -2.44763,5.5 
            -5.5,5.5c-3.05237,0 -5.5,-2.44763 -5.5,-5.5
            c0,-3.05237 2.44763,-5.5 5.5,-5.5z"></path>
                </g>
              </g>
            </svg>
          </button>
        </div>
        <select name="ordering">
          <option value="-created_at">جدیدترین</option>
          <option value="created_at">قدیمی‌ترین</option>
          <option value="title">محبوب‌ترین</option>
        </select>

          {% comment %} <fieldset>
            <legend>دسته‌بندی‌ها</legend>
            <ul class="category-tree">
              {% for parent in categories %}
                <li>
                  <label>
                    <input type="checkbox"
                          class="category-parent"
                          value="{{ parent.id }}"
                          name="categories"
                          {% if parent.id in selected_categories %}checked{% endif %}>
                    {{ parent.name }}
                  </label>
                  {% if parent.children.all %}
                    <ul>
                      {% for child in parent.children.all %}
                        <li>
                          <label>
                            <input type="checkbox"
                                  class="category-child"
                                  data-parent="{{ parent.id }}"
                                  value="{{ child.id }}"
                                  name="categories"
                                  {% if child.id in selected_categories %}checked{% endif %}>
                            {{ child.name }}
                          </label>
                        </li>
                      {% endfor %}
                    </ul>
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          </fieldset> {% endcomment %}

          <fieldset>
            <legend>دسته‌بندی‌ها</legend>
            <ul class="category-tree">
              {% for category in categories %}
                {% include "partials/category_node.html" with category=category %}
              {% endfor %}
            </ul>

          </fieldset>

        <fieldset class="tag-tree">
            <legend>تگ‌ها</legend>
            {% for tag in tags %}
                <label>
                    <input
                        type="checkbox"
                        name="tags"
                        value="{{ tag.id }}"
                        {% if tag.id in selected_tags %}checked{% endif %}
                    >
                    {{ tag.name }}
                </label>
            {% endfor %}
        </fieldset>
        <button class="filter-button" type="submit">
          اعمال فیلتر
        </button>
      </form>
    </div>

    {% comment %}speech List{% endcomment %}
    <div class="speech-list-panel">
      {% for item in speechList %}
        {% comment %}! speech-card{% endcomment %}
        <div class="speech-card" href="{% url 'speech:detail' speechSlug=item.slug %}">
          <div class="speech-image">
            {% comment %} <img src="{% static 'Screenshot_2014-10-23-16-25-08.png' %}" alt="" /> {% endcomment %}
            <img src="{{ item.image.url }}" alt="" />
          </div>

          <div class="speech-card-contet">
            <div class="speech-card-header">
              {% comment %} <h2>شب پنجم محرم ۱۴۰۴</h2> {% endcomment %}
              <a href="{% url 'speech:detail' speechSlug=item.slug %}">
                <h2>{{ item.title }}</h2>
              </a>
              <div class="speech-card-feedback">
                <div>
                  {% comment %} <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256"><g fill="currentColor" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(8.53333,8.53333)"><path d="M15,5c-8.9183,0 -14.67901,9.21118 -14.7832,9.37891c-0.14024,0.17666 -0.21665,0.39554 -0.2168,0.62109c0.00018,0.1935 0.05649,0.38279 0.16211,0.54492c0.0013,0.00196 0.0026,0.00391 0.00391,0.00586c0.01719,0.03548 4.85282,9.44922 14.83398,9.44922c9.93882,0 14.76733,-9.32126 14.82617,-9.43555c0.00398,-0.00647 0.00789,-0.01298 0.01172,-0.01953c0.10562,-0.16213 0.16193,-0.35142 0.16211,-0.54492c-0.00004,-0.22465 -0.07572,-0.44275 -0.21484,-0.61914c-0.00065,-0.00065 -0.0013,-0.0013 -0.00195,-0.00195c-0.10419,-0.16773 -5.86491,-9.37891 -14.7832,-9.37891zM15,8c3.866,0 7,3.134 7,7c0,3.866 -3.134,7 -7,7c-3.866,0 -7,-3.134 -7,-7c0,-3.866 3.134,-7 7,-7zM15,12c-1.65685,0 -3,1.34315 -3,3c0,1.65685 1.34315,3 3,3c1.65685,0 3,-1.34315 3,-3c0,-1.65685 -1.34315,-3 -3,-3z"></path></g></g></svg> {% endcomment %}
                  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256">
                    <g fill="currentColor" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal">
                      <g transform="scale(5.12,5.12)">
                        <path d="M25,12c-13.33203,0 -23.75,12.34375 -23.75,12.34375c-0.32812,0.375 -0.32812,0.9375 0,1.3125c0,0 10.41797,12.34375 23.75,12.34375c13.33203,0 23.75,-12.34375 23.75,-12.34375c0.32813,-0.375 0.32813,-0.9375 0,-1.3125c0,0 -10.41797,-12.34375 -23.75,-12.34375zM25,14c2.62891,0 5.14063,0.54297 7.46875,1.375c1.5625,1.76563 2.53125,4.07422 2.53125,6.625c0,5.53516 -4.46484,10 -10,10c-5.53516,0 -10,-4.46484 -10,-10c0,-2.55078 0.9375,-4.85937 2.5,-6.625c2.33594,-0.83594 4.86328,-1.375 7.5,-1.375zM14.1875,16.84375c-0.75,1.5625 -1.1875,3.3125 -1.1875,5.15625c0,6.61719 5.38281,12 12,12c6.61719,0 12,-5.38281 12,-12c0,-1.83594 -0.41797,-3.59375 -1.15625,-5.15625c5.64844,2.87109 9.71094,7.03516 10.75,8.15625c-1.625,1.75781 -10.62109,11 -21.59375,11c-10.97266,0 -19.96875,-9.24219 -21.59375,-11c1.03906,-1.125 5.12109,-5.28516 10.78125,-8.15625zM25,17c-2.76172,0 -5,2.23828 -5,5c0,2.76172 2.23828,5 5,5c2.76172,0 5,-2.23828 5,-5c0,-2.76172 -2.23828,-5 -5,-5z"></path>
                      </g>
                    </g>
                  </svg>
                  <span>{{ item.visit_count }}</span>
                </div>
                <div>
                  {% comment %} <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256"><g fill="currentColor" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(8.53333,8.53333)"><path d="M9.54492,4c-3.615,0 -6.54492,2.92992 -6.54492,6.54492c0,6.2924 7.29898,12.30488 10.70898,14.98242c0.00325,0.00261 0.0065,0.00522 0.00977,0.00781c0.02337,0.01834 0.05513,0.04447 0.07813,0.0625l0.00195,-0.00195c0.34597,0.26142 0.76754,0.40331 1.20117,0.4043c0.4343,-0.00056 0.85662,-0.14248 1.20313,-0.4043v0.00195c0.00673,-0.00528 0.01668,-0.01227 0.02344,-0.01758c0.00514,-0.00403 0.01242,-0.00962 0.01758,-0.01367c0.00655,-0.00582 0.01306,-0.01168 0.01953,-0.01758c3.39944,-2.66792 10.73633,-8.69649 10.73633,-15.00391c0,-3.615 -2.92992,-6.54492 -6.54492,-6.54492c-3.455,0 -5.45508,3 -5.45508,3c0,0 -2.00008,-3 -5.45508,-3z"></path></g></g></svg>         {% endcomment %}
                  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256">
                    <g fill="currentColor" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal">
                      <g transform="scale(5.12,5.12)">
                        <path d="M15,7c-7.16797,0 -13,5.83203 -13,13c0,14.76172 16.69531,22.04688 22.375,26.78125l0.625,0.53125l0.625,-0.53125c5.67969,-4.73437 22.375,-12.01953 22.375,-26.78125c0,-7.16797 -5.83203,-13 -13,-13c-4.05469,0 -7.61719,1.92578 -10,4.84375c-2.38281,-2.91797 -5.94531,-4.84375 -10,-4.84375zM15,9c3.83594,0 7.1875,1.96875 9.15625,4.9375l0.84375,1.25l0.84375,-1.25c1.96875,-2.96875 5.32031,-4.9375 9.15625,-4.9375c6.08594,0 11,4.91406 11,11c0,12.89844 -14.40625,19.57422 -21,24.78125c-6.59375,-5.20703 -21,-11.88281 -21,-24.78125c0,-6.08594 4.91406,-11 11,-11z"></path>
                      </g>
                    </g>
                  </svg>
                  <span>700</span>
                </div>
                <div>
                  {% comment %} <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256"><g fill="currentColor" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(5.12,5.12)"><path d="M12,0c-1.09375,0 -2,0.90625 -2,2v2h-6c-1.16016,0 -2,0.83984 -2,2v7h46v-7c0,-1.16016 -0.83984,-2 -2,-2h-6v-2c0,-1.09375 -0.90625,-2 -2,-2h-2c-1.09375,0 -2,0.90625 -2,2v2h-18v-2c0,-1.09375 -0.90625,-2 -2,-2zM12,2h2v6h-2zM36,2h2v6h-2zM2,15v31c0,1.16016 0.83984,2 2,2h42c1.16016,0 2,-0.83984 2,-2v-31zM12,21h5v5h-5zM19,21h5v5h-5zM26,21h5v5h-5zM33,21h5v5h-5zM12,28h5v5h-5zM19,28h5v5h-5zM26,28h5v5h-5zM33,28h5v5h-5zM12,35h5v5h-5zM19,35h5v5h-5zM26,35h5v5h-5zM33,35h5v5h-5z"></path></g></g></svg> {% endcomment %}
                  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256"><g fill="currentColor" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(5.12,5.12)"><path d="M12,0c-1.09375,0 -2,0.90625 -2,2v2h-6c-0.52344,0 -1.05469,0.19141 -1.42969,0.57031c-0.37891,0.375 -0.57031,0.90625 -0.57031,1.42969v40c0,0.52344 0.19141,1.05469 0.57031,1.43359c0.375,0.375 0.90625,0.56641 1.42969,0.56641h42c0.52344,0 1.05469,-0.19141 1.43359,-0.56641c0.375,-0.37891 0.56641,-0.91016 0.56641,-1.43359v-40c0,-0.52344 -0.19141,-1.05469 -0.56641,-1.42969c-0.37891,-0.37891 -0.91016,-0.57031 -1.43359,-0.57031h-6v-2c0,-1.09375 -0.90625,-2 -2,-2h-2c-1.09375,0 -2,0.90625 -2,2v2h-18v-2c0,-1.09375 -0.90625,-2 -2,-2zM12,2h2v6h-2zM36,2h2v6h-2zM4,6h6v2c0,1.09375 0.90625,2 2,2h2c1.09375,0 2,-0.90625 2,-2v-2h18v2c0,1.09375 0.90625,2 2,2h2c1.09375,0 2,-0.90625 2,-2v-2h6v7h-42zM4,15h42v31h-42zM10,19v23h30v-23zM12,21h5v5h-5zM19,21h5v5h-5zM26,21h5v5h-5zM33,21h5v5h-5zM12,28h5v5h-5zM19,28h5v5h-5zM26,28h5v5h-5zM33,28h5v5h-5zM12,35h5v5h-5zM19,35h5v5h-5zM26,35h5v5h-5zM33,35h5v5h-5z"></path></g></g></svg>
                  <span>{{ item.event_date_time }}</span>
                </div>
              </div>
            </div>
            <p class="speech-card-description">{{ item.sumary }}</p>
            {% comment %} <div class="tags-styles">#محرم #دهه_محرم #محرم۱۴۰۴ #محرم_۱۴۰۴ #سخنرانی_محرم #مراسم_محرم #محرم_حسینی #محرم_ماه_خدا #هیئت #هیئت_آنلاین #مراسم_عزاداری #محرم_مجازی</div> {% endcomment %}
            <ul class="speech-tags-and-categories">
                {% for cat in item.category.all %}
                <li>
                  <a href="{% url 'speech:tag_detail' cat.slug %}"> 
                    {{ cat.name }}
                  </a> 
                </li>
                {% endfor %}
            </ul>
            {% if item.tag.exists %}
              <div class="speech-tags-and-categories">
                {% for tag in item.tag.all %}
                  <a href="{% url 'speech:tag_detail' tag.slug %}">#{{ tag.name }}</a>
                {% endfor %}
              </div>
            {% endif %}
            <div class="view-more">
              <a href="{% url 'speech:detail' speechSlug=item.slug %}">
                نمایش بیشتر
              </a>
            </div>
          </div>
        </div>
      {% endfor %}

      <div class="pagination-container">
        <ul class="pagination" id="pagination">
          {% comment %}! اولین اولین صفحه{% endcomment %}
          <li class="pagination-item">
            <a href="?page=1" class="pagination-link pagination-arrow {% if not speechList.has_previous %}disabled{% endif %}" data-action="first" aria-label="First page">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="11 17 6 12 11 7"></polyline>
                <polyline points="18 17 13 12 18 7"></polyline>
              </svg>
            </a>
          </li>
          {% comment %}! صفحه قبلی{% endcomment %}
          <li class="pagination-item">
            <a href="?page={% if speechList.has_previous %}{{ speechList.previous_page_number }}{% endif %}" class="pagination-link pagination-arrow {% if not speechList.has_previous %}disabled{% endif %}" data-action="prev" aria-label="Previous page">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </a>
          </li>

          {% for i in speechList.paginator.page_range %}
            {% comment %}یه شرط زیر براشون میزاریم تا به تعداد صفحات مشخصی رندر شود{% endcomment %}
            {% if i >= speechList.number|add:'-2' and i <= speechList.number|add:'2' %}
              {% if speechList.number == i %}
                <li class="pagination-item">
                  <a href="?page={{ i }}" class="pagination-link active">{{ i }}</a>
                </li>
              {% else %}
                <li class="pagination-item">
                  <a href="?page={{ i }}" class="pagination-link">{{ i }}</a>
                </li>
              {% endif %}
              {% comment %}! صفوحات{% endcomment %}
              {% comment %} <li class="pagination-item">
                <a href="#" class="pagination-link active" data-page="1">1</a>
              </li>
              <li class="pagination-item">
                <a href="#" class="pagination-link" data-page="2">2</a>
              </li>
              <li class="pagination-item">
                <a href="#" class="pagination-link" data-page="3">3</a>
              </li>
              <li class="pagination-item">
                <span class="pagination-ellipsis">...</span>
              </li>
              <li class="pagination-item">
                <a href="#" class="pagination-link" data-page="30">30</a>
              </li> {% endcomment %}
            {% elif i == speechList.number|add:'-3' or i == speechList.number|add:'3' %}
              <li class="pagination-item">
                <span class="pagination-ellipsis">...</span>
              </li>
            {% endif %}
          {% endfor %}

          {% comment %}! صفحه بعدی{% endcomment %}
          <li class="pagination-item">
            <a href="?page={% if speechList.has_next %}{{ speechList.next_page_number }}{% endif %}" class="pagination-link pagination-arrow {% if not speechList.has_next %}disabled{% endif %}" data-action="next" aria-label="Next page">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </a>
          </li>
          {% comment %}! آخرین آخرین صفحه{% endcomment %}
          <li class="pagination-item">
            <a href="?page={{ speechList.paginator.num_pages }}" class="pagination-link pagination-arrow {% if not speechList.has_next %}disabled{% endif %}" data-action="last" aria-label="Last page">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="13 17 18 12 13 7"></polyline>
                <polyline points="6 17 11 12 6 7"></polyline>
              </svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
{% endblock %}
